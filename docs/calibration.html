<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Camera Calibration · PyRobot</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;A calibrated camera system is required for several applications in navigation and manipulation. Here are the steps to complete the calibration for &lt;em&gt;LoCoBot&lt;/em&gt; and &lt;em&gt;LoCoBot-Lite&lt;/em&gt;. The parameters are saved to ~/.robot/ and will be published to ROS &lt;em&gt;tf&lt;/em&gt; when the robot is running. If you do not calibrate, the launch files will use the default parameters which may not be accurate for your setup.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Camera Calibration · PyRobot"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebookresearch.github.io/pyrobot/"/><meta property="og:description" content="&lt;p&gt;A calibrated camera system is required for several applications in navigation and manipulation. Here are the steps to complete the calibration for &lt;em&gt;LoCoBot&lt;/em&gt; and &lt;em&gt;LoCoBot-Lite&lt;/em&gt;. The parameters are saved to ~/.robot/ and will be published to ROS &lt;em&gt;tf&lt;/em&gt; when the robot is running. If you do not calibrate, the launch files will use the default parameters which may not be accurate for your setup.&lt;/p&gt;
"/><meta property="og:image" content="https://facebookresearch.github.io/pyrobot/img/pyrobot_icon.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://facebookresearch.github.io/pyrobot/img/pyrobot_icon.svg"/><link rel="shortcut icon" href="/pyrobot/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><link rel="stylesheet" href="/pyrobot/css/main.css"/><script src="/pyrobot/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/pyrobot/"><img class="logo" src="/pyrobot/img/pyrobot_icon.svg" alt="PyRobot"/><h2 class="headerTitleWithLogo">PyRobot</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/pyrobot/docs/overview" target="_self">Tutorials</a></li><li class=""><a href="https://pyrobot-api.netlify.com" target="_self">API</a></li><li class="siteNavGroupActive"><a href="/pyrobot/docs/faq" target="_self">Help</a></li><li class=""><a href="https://github.com/adithyamurali/pyrobot" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Examples</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/pyrobot/docs/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/software">Install software</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Examples</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/pyrobot/docs/calibration">[Basic] Camera Calibration</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/navigation">[Basic] Navigation</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/manipulation">[Basic] Manipulation</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/demonstrations">[Basic] Demonstration</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/active_camera">[Basic] Active Camera</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/crashing">[Advanced] Avoid crashing</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/grasping">[Advanced] Grasping</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/sim2real">[Advanced] Sim2Real</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/visual_nav_cmp">[Advanced] Visual Navigation (CMP)</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Help and Support</h3><ul class=""><li class="navListItem"><a class="navItem" href="/pyrobot/docs/new_robot_support">New Robot Support</a></li><li class="navListItem"><a class="navItem" href="/pyrobot/docs/faq">FAQ</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Camera Calibration</h1></header><article><div><span><p>A calibrated camera system is required for several applications in navigation and manipulation. Here are the steps to complete the calibration for <em>LoCoBot</em> and <em>LoCoBot-Lite</em>. The parameters are saved to ~/.robot/ and will be published to ROS <em>tf</em> when the robot is running. If you do not calibrate, the launch files will use the default parameters which may not be accurate for your setup.</p>
<h2><a class="anchor" aria-hidden="true" id="automatic-camera-calibration"></a><a href="#automatic-camera-calibration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Automatic camera calibration</h2>
<ol>
<li>Make sure that the AR Tag is mounted to the arm end effector in the right orientation, as follows</li>
</ol>
<p><img class="doc_vid" src="media/ar_tag.jpg"></p>
<ol>
<li>Start all the ROS services.</li>
</ol>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># Launch the arm controllers, ar_tag tracker, etc.</span>
roslaunch locobot_calibration calibrate.launch
</code></pre>
<ol start="2">
<li>In another terminal, run the script to collect data for calibration (should will take about 10 minutes). The robot will move the arm and camera around and record images and joint angles. Keep robot arm workspace clear of obstacles.</li>
</ol>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># By default the calibration routine will use 5 fixed poses.</span>
python locobot_calibration/scripts/calibration.py \
    --data_dir tmp/calibration-data/v1/

<span class="hljs-comment"># (Optional) Instead of using fixed poses, you can also take the robot arm to</span>
<span class="hljs-comment"># random poses, using the use_random_poses flag.</span>
python locobot_calibration/scripts/calibration.py \
    --data_dir tmp/calibration-data/v1/ \
    --use_random_poses --num_arm_poses 10
</code></pre>
<ol start="3">
<li>Run the following script to solve for the calibration parameters. The calibrated parameters would be saved to <em>~/.robot/calibrated.json</em>.</li>
</ol>
<pre><code class="hljs css language-bash">python locobot_calibration/scripts/calibration_solver.py \
    --data_dir tmp/calibration-data/v1/ \
    --calibration_output_file ~/.robot/calibrated.json \
    --overwrite 
</code></pre>
<p>The solver setups up a least square pixel re-projection error between the estimated location of the AR tag corners using the kinematic chain, and the detected location of AR tag corners using basic image processing. Transforms listed in scripts/calibration_solver.py are optimized using gradient descent. Calibration parameters are saved to calibration_output_file. Note that the solver first optimizes for translation parameters and then estimates both translation and rotation. The solver prints out the pixel error. In practice, we have observed a pixel error of 3-5 pixels gives reasonable performance. If the solver is only able to converge to a larger error, a) you should verify the data being used for calibration (dir_name will contain a directory tag_detect that will contain the images with the detected tag corners, visually scan to make sure they are accurate and don't have too many outliers), b) play around with the solver parameters (learning rate, ADAM parameters, robust loss parameters, etc.).</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/pyrobot/docs/software"><span class="arrow-prev">← </span><span>Install software</span></a><a class="docs-next button" href="/pyrobot/docs/navigation"><span>[Basic] Navigation</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#automatic-camera-calibration">Automatic camera calibration</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/pyrobot/" class="nav-home"><img src="/pyrobot/img/pyrobot_icon.svg" alt="PyRobot" width="66" height="58"/></a><div><h5>Docs</h5><a href="/pyrobot/docs/en/overview.html">Getting Started</a></div><div><h5>More</h5><a href="https://github.com/adithyamurali/pyrobot">GitHub</a></div></section></footer></div></body></html>